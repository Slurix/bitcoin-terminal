<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>₿ BITCOIN TERMINAL — NEWS FEED</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --btc: #f7931a;
    --btc-dim: #c4720e;
    --btc-glow: rgba(247, 147, 26, 0.4);
    --green: #00ff88;
    --red: #ff3366;
    --yellow: #ffe066;
    --bg: #050508;
    --bg2: #0a0a10;
    --bg3: #0f0f18;
    --border: rgba(247, 147, 26, 0.2);
    --text: #e8d5b0;
    --dim: #6b5c42;
    --panel: rgba(10, 10, 16, 0.95);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.15) 2px, rgba(0,0,0,0.15) 4px);
    pointer-events: none;
    z-index: 1000;
  }

  .bg-anim {
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 10% 0%, rgba(247,147,26,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 60% 80% at 90% 100%, rgba(247,147,26,0.04) 0%, transparent 60%),
      var(--bg);
    z-index: 0;
  }

  .bg-grid {
    position: fixed; inset: 0;
    background-image: linear-gradient(rgba(247,147,26,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(247,147,26,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    z-index: 0;
  }

  .wrap { position: relative; z-index: 1; padding: 20px; max-width: 1800px; margin: 0 auto; }

  /* HEADER */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 24px;
    border: 1px solid var(--border);
    background: var(--panel);
    margin-bottom: 20px;
    position: relative; overflow: hidden;
  }
  header::after {
    content: ''; position: absolute; bottom: 0; left: 0; right: 0;
    height: 1px; background: linear-gradient(90deg, transparent, var(--btc), transparent);
  }

  .logo { font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: 900; color: var(--btc); letter-spacing: 4px; text-shadow: 0 0 20px var(--btc-glow); }
  .logo span { color: var(--text); font-weight: 400; font-size: 14px; letter-spacing: 2px; display: block; }

  .header-right { display: flex; align-items: center; gap: 24px; }
  .live-badge { display: flex; align-items: center; gap: 8px; font-size: 11px; letter-spacing: 2px; color: var(--red); }
  .live-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--red); animation: pulse-red 1.5s ease-in-out infinite; }
  @keyframes pulse-red { 0%,100% { box-shadow: 0 0 4px var(--red); } 50% { box-shadow: 0 0 12px var(--red), 0 0 20px var(--red); } }
  #clock { font-family: 'Share Tech Mono'; font-size: 13px; color: var(--dim); }

  /* NAV */
  nav {
    display: flex; gap: 2px; margin-bottom: 20px;
    border: 1px solid var(--border);
    background: var(--panel);
    padding: 6px;
  }
  .nav-link {
    padding: 8px 20px; font-family: 'Orbitron'; font-size: 10px; letter-spacing: 2px;
    text-decoration: none; color: var(--dim); text-transform: uppercase;
    border: 1px solid transparent; transition: all 0.2s; cursor: pointer;
  }
  .nav-link:hover { color: var(--btc); border-color: var(--border); }
  .nav-link.active { color: var(--btc); border-color: var(--btc); background: rgba(247,147,26,0.08); }

  /* BREAKING TICKER */
  .breaking-bar {
    border: 1px solid rgba(255,51,102,0.4);
    background: rgba(255,51,102,0.06);
    padding: 10px 0;
    margin-bottom: 20px;
    overflow: hidden;
    position: relative;
  }
  .breaking-bar::before {
    content: '⚡ BREAKING';
    position: absolute; left: 0; top: 0; bottom: 0;
    display: flex; align-items: center;
    padding: 0 16px;
    background: var(--red);
    color: #000; font-family: 'Orbitron'; font-size: 9px; font-weight: 700;
    letter-spacing: 2px; z-index: 2;
  }
  .breaking-scroll { display: flex; gap: 80px; animation: scroll-breaking 40s linear infinite; white-space: nowrap; padding-left: 120px; }
  @keyframes scroll-breaking { from { transform: translateX(0); } to { transform: translateX(-50%); } }
  .breaking-item { font-size: 12px; color: var(--text); font-family: 'Share Tech Mono'; }
  .breaking-item span { color: var(--red); margin-right: 8px; }

  /* PRICE BAR */
  .price-strip {
    display: flex; gap: 24px; align-items: center;
    padding: 12px 20px;
    border: 1px solid var(--border);
    background: var(--panel);
    margin-bottom: 20px;
    overflow-x: auto;
    flex-wrap: wrap;
  }
  .ps-item { display: flex; flex-direction: column; gap: 2px; min-width: fit-content; }
  .ps-label { font-size: 9px; letter-spacing: 2px; color: var(--dim); text-transform: uppercase; }
  .ps-value { font-family: 'Orbitron'; font-size: 15px; font-weight: 700; color: var(--btc); }
  .ps-change { font-size: 10px; }
  .ps-divider { width: 1px; height: 36px; background: var(--border); flex-shrink: 0; }

  /* MAIN LAYOUT */
  .main-grid { display: grid; grid-template-columns: 1fr 360px; gap: 20px; }
  @media (max-width: 1100px) { .main-grid { grid-template-columns: 1fr; } }

  /* FILTER BAR */
  .filter-bar { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
  .filter-btn {
    padding: 5px 14px; font-size: 10px; letter-spacing: 1px;
    font-family: 'JetBrains Mono'; cursor: pointer;
    background: transparent; border: 1px solid var(--border);
    color: var(--dim); text-transform: uppercase; transition: all 0.2s;
  }
  .filter-btn:hover, .filter-btn.active { background: rgba(247,147,26,0.15); border-color: var(--btc); color: var(--btc); }

  /* NEWS CARD */
  .news-card {
    border: 1px solid var(--border);
    background: var(--panel);
    padding: 20px;
    margin-bottom: 14px;
    position: relative;
    overflow: hidden;
    transition: all 0.25s;
    cursor: pointer;
    text-decoration: none;
    display: block;
    color: inherit;
  }
  .news-card:hover { border-color: rgba(247,147,26,0.5); background: rgba(247,147,26,0.03); transform: translateX(2px); }
  .news-card::before {
    content: ''; position: absolute;
    left: 0; top: 0; bottom: 0; width: 3px;
    background: var(--btc);
    transform: scaleY(0); transform-origin: bottom;
    transition: transform 0.25s;
  }
  .news-card:hover::before { transform: scaleY(1); }
  .news-card.breaking { border-color: rgba(255,51,102,0.4); }
  .news-card.breaking::before { background: var(--red); }

  .news-meta { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
  .news-source { font-family: 'Orbitron'; font-size: 9px; letter-spacing: 2px; color: var(--btc); }
  .news-source.breaking-src { color: var(--red); }
  .news-time { font-size: 10px; color: var(--dim); }
  .news-badge {
    padding: 2px 8px; font-size: 9px; letter-spacing: 1px; border: 1px solid;
    text-transform: uppercase; font-family: 'Orbitron';
  }
  .badge-bullish { color: var(--green); border-color: rgba(0,255,136,0.3); background: rgba(0,255,136,0.08); }
  .badge-bearish { color: var(--red); border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.08); }
  .badge-neutral { color: var(--dim); border-color: rgba(107,92,66,0.3); background: rgba(107,92,66,0.05); }
  .badge-breaking { color: var(--red); border-color: var(--red); background: rgba(255,51,102,0.1); animation: badge-pulse 1.5s ease-in-out infinite; }
  @keyframes badge-pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }

  .news-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 8px; line-height: 1.5; }
  .news-body { font-size: 11px; color: var(--dim); line-height: 1.7; margin-bottom: 10px; }
  .news-tags { display: flex; gap: 6px; flex-wrap: wrap; }
  .news-tag { font-size: 9px; padding: 2px 6px; background: rgba(247,147,26,0.07); border: 1px solid rgba(247,147,26,0.12); color: var(--dim); letter-spacing: 1px; }

  /* SIDEBAR */
  .sidebar { display: flex; flex-direction: column; gap: 16px; }

  .panel {
    border: 1px solid var(--border);
    background: var(--panel);
    padding: 18px;
    position: relative; overflow: hidden;
    transition: border-color 0.3s;
  }
  .panel:hover { border-color: rgba(247,147,26,0.4); }
  .panel-title {
    font-family: 'Orbitron'; font-size: 10px; letter-spacing: 3px; color: var(--btc);
    text-transform: uppercase; margin-bottom: 14px; padding-bottom: 10px;
    border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px;
  }
  .panel-title::before { content: '//'; color: var(--dim); }

  /* TRENDING */
  .trend-item { display: flex; align-items: flex-start; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(247,147,26,0.06); }
  .trend-item:last-child { border-bottom: none; }
  .trend-num { font-family: 'Orbitron'; font-size: 18px; font-weight: 900; color: rgba(247,147,26,0.15); min-width: 28px; }
  .trend-title { font-size: 11px; color: var(--text); line-height: 1.5; }
  .trend-meta { font-size: 10px; color: var(--dim); margin-top: 3px; }

  /* SENTIMENT GAUGE */
  .sentiment-bar { height: 8px; border-radius: 4px; overflow: hidden; background: rgba(255,255,255,0.06); margin: 10px 0 4px; }
  .sentiment-fill { height: 100%; border-radius: 4px; transition: width 1s ease; }
  .sent-row { display: flex; justify-content: space-between; font-size: 10px; color: var(--dim); }

  /* EVENTS */
  .event-item { display: flex; gap: 12px; padding: 10px 0; border-bottom: 1px solid rgba(247,147,26,0.06); }
  .event-item:last-child { border-bottom: none; }
  .event-date { min-width: 52px; text-align: center; }
  .event-date .e-day { font-family: 'Orbitron'; font-size: 20px; font-weight: 700; color: var(--btc); line-height: 1; }
  .event-date .e-mon { font-size: 9px; color: var(--dim); letter-spacing: 2px; text-transform: uppercase; }
  .event-info .e-title { font-size: 11px; color: var(--text); margin-bottom: 3px; }
  .event-info .e-desc { font-size: 10px; color: var(--dim); line-height: 1.5; }

  /* SOURCES */
  .source-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(247,147,26,0.06); font-size: 11px; }
  .source-item:last-child { border-bottom: none; }
  .source-count { font-family: 'Share Tech Mono'; color: var(--btc); }

  /* LOADING */
  .loading-state { text-align: center; padding: 40px; color: var(--dim); font-size: 12px; letter-spacing: 2px; }
  .loading-state::after { content: '...'; animation: dots 1.5s steps(3) infinite; }
  @keyframes dots { 0%,100% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }

  /* SEARCH */
  .search-wrap { margin-bottom: 16px; position: relative; }
  .search-input {
    width: 100%; padding: 10px 16px 10px 40px;
    background: rgba(247,147,26,0.04); border: 1px solid var(--border);
    color: var(--text); font-family: 'JetBrains Mono'; font-size: 12px;
    outline: none; transition: border-color 0.2s;
  }
  .search-input:focus { border-color: var(--btc); }
  .search-input::placeholder { color: var(--dim); }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--dim); font-size: 14px; }

  /* STATUS BAR */
  .status-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 6px 12px; border: 1px solid var(--border);
    background: var(--panel); margin-bottom: 16px; font-size: 10px;
  }
  .status-count { color: var(--dim); }
  .status-count span { color: var(--btc); font-family: 'Share Tech Mono'; }

  /* PAGINATION */
  .pagination { display: flex; gap: 6px; margin-top: 16px; justify-content: center; }
  .page-btn { padding: 6px 12px; font-size: 10px; font-family: 'JetBrains Mono'; border: 1px solid var(--border); background: transparent; color: var(--dim); cursor: pointer; transition: all 0.2s; }
  .page-btn:hover, .page-btn.active { border-color: var(--btc); color: var(--btc); background: rgba(247,147,26,0.08); }

  /* MODAL */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
  .modal-overlay.open { display: flex; }
  .modal {
    max-width: 700px; width: 100%; max-height: 80vh; overflow-y: auto;
    border: 1px solid var(--btc); background: var(--bg2); padding: 28px;
    position: relative;
  }
  .modal-close { position: absolute; top: 14px; right: 14px; cursor: pointer; color: var(--dim); font-size: 18px; background: none; border: none; }
  .modal-close:hover { color: var(--btc); }
  .modal-title { font-family: 'Orbitron'; font-size: 14px; font-weight: 700; color: var(--text); line-height: 1.5; margin-bottom: 16px; }
  .modal-body { font-size: 12px; color: var(--dim); line-height: 1.9; }
  .modal-footer { margin-top: 20px; padding-top: 14px; border-top: 1px solid var(--border); display: flex; gap: 12px; align-items: center; }
  .modal-link { color: var(--btc); font-size: 11px; text-decoration: none; letter-spacing: 1px; }
  .modal-link:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="bg-anim"></div>
<div class="bg-grid"></div>

<div class="wrap">
  <!-- HEADER -->
  <header>
    <div class="logo">
      ₿ITCOIN TERMINAL
      <span>LIVE NEWS INTELLIGENCE FEED</span>
    </div>
    <div class="header-right">
      <div class="live-badge"><div class="live-dot"></div>BREAKING</div>
      <div id="clock">--:--:--</div>
    </div>
  </header>

  <!-- NAV -->
  <nav>
    <a href="index.html" class="nav-link">⬡ DASHBOARD</a>
    <a href="news.html" class="nav-link active">⬡ NEWS FEED</a>
  </nav>

  <!-- BREAKING TICKER -->
  <div class="breaking-bar">
    <div class="breaking-scroll" id="breaking-scroll">
      <span class="breaking-item"><span>▶</span>Loading latest Bitcoin headlines...</span>
      <span class="breaking-item"><span>▶</span>Loading latest Bitcoin headlines...</span>
    </div>
  </div>

  <!-- PRICE STRIP -->
  <div class="price-strip">
    <div class="ps-item">
      <div class="ps-label">BTC / USD</div>
      <div class="ps-value" id="ps-price">$—</div>
      <div class="ps-change" id="ps-change">—</div>
    </div>
    <div class="ps-divider"></div>
    <div class="ps-item">
      <div class="ps-label">24H HIGH</div>
      <div class="ps-value" id="ps-high" style="font-size:13px;">—</div>
    </div>
    <div class="ps-divider"></div>
    <div class="ps-item">
      <div class="ps-label">24H LOW</div>
      <div class="ps-value" id="ps-low" style="font-size:13px;">—</div>
    </div>
    <div class="ps-divider"></div>
    <div class="ps-item">
      <div class="ps-label">MARKET CAP</div>
      <div class="ps-value" id="ps-mcap" style="font-size:13px;">—</div>
    </div>
    <div class="ps-divider"></div>
    <div class="ps-item">
      <div class="ps-label">FEAR & GREED</div>
      <div class="ps-value" id="ps-fg" style="font-size:13px;">—</div>
    </div>
    <div class="ps-divider"></div>
    <div class="ps-item">
      <div class="ps-label">DOMINANCE</div>
      <div class="ps-value" id="ps-dom" style="font-size:13px;">—</div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main-grid">
    <!-- NEWS FEED -->
    <div>
      <div class="search-wrap">
        <span class="search-icon">⌕</span>
        <input type="text" class="search-input" id="search-input" placeholder="SEARCH ARTICLES, TOPICS, SOURCES...">
      </div>

      <div class="filter-bar">
        <button class="filter-btn active" onclick="filterNews('all', this)">ALL</button>
        <button class="filter-btn" onclick="filterNews('breaking', this)">BREAKING</button>
        <button class="filter-btn" onclick="filterNews('markets', this)">MARKETS</button>
        <button class="filter-btn" onclick="filterNews('regulation', this)">REGULATION</button>
        <button class="filter-btn" onclick="filterNews('technology', this)">TECHNOLOGY</button>
        <button class="filter-btn" onclick="filterNews('mining', this)">MINING</button>
        <button class="filter-btn" onclick="filterNews('etf', this)">ETF</button>
        <button class="filter-btn" onclick="filterNews('macro', this)">MACRO</button>
      </div>

      <div class="status-bar">
        <div class="status-count">ARTICLES LOADED: <span id="article-count">0</span></div>
        <div id="last-fetch" style="font-size:10px;color:var(--dim);">FETCHING...</div>
      </div>

      <div id="news-feed">
        <div class="loading-state">CONNECTING TO FEED</div>
      </div>

      <div class="pagination" id="pagination"></div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
      <!-- Sentiment -->
      <div class="panel">
        <div class="panel-title">MARKET SENTIMENT</div>
        <div id="sentiment-display">
          <div style="font-size:10px;color:var(--dim);margin-bottom:8px;">BASED ON LATEST HEADLINES</div>
          <div id="sent-label" style="font-family:'Orbitron';font-size:18px;color:var(--dim);">ANALYZING</div>
          <div class="sentiment-bar">
            <div class="sentiment-fill" id="sent-bar" style="width:50%;background:var(--dim)"></div>
          </div>
          <div class="sent-row">
            <span id="sent-bearish-pct">—% BEARISH</span>
            <span id="sent-bullish-pct">—% BULLISH</span>
          </div>
        </div>
      </div>

      <!-- Trending Topics -->
      <div class="panel">
        <div class="panel-title">TRENDING TOPICS</div>
        <div id="trending-topics">
          <div class="loading-state">ANALYZING</div>
        </div>
      </div>

      <!-- Upcoming Events -->
      <div class="panel">
        <div class="panel-title">UPCOMING EVENTS</div>
        <div id="upcoming-events"></div>
      </div>

      <!-- News Sources -->
      <div class="panel">
        <div class="panel-title">TOP SOURCES</div>
        <div id="sources-list">
          <div class="loading-state">LOADING</div>
        </div>
      </div>

      <!-- Fear & Greed History -->
      <div class="panel">
        <div class="panel-title">F&G HISTORY (7D)</div>
        <div id="fg-history">
          <div class="loading-state">FETCHING</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">✕</button>
    <div class="modal-title" id="modal-title"></div>
    <div id="modal-meta" style="margin-bottom:14px;display:flex;gap:10px;flex-wrap:wrap;font-size:10px;color:var(--dim);"></div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-footer">
      <a href="#" class="modal-link" id="modal-link" target="_blank">READ FULL ARTICLE →</a>
    </div>
  </div>
</div>

<script>
// ═══════════════════════════════════════
// UTILS
// ═══════════════════════════════════════
const fmt = {
  price: v => v != null ? '$' + Number(v).toLocaleString('en-US', {minimumFractionDigits:2,maximumFractionDigits:2}) : '—',
  compact: v => {
    if (!v) return '—';
    if (v >= 1e12) return '$' + (v/1e12).toFixed(2) + 'T';
    if (v >= 1e9) return '$' + (v/1e9).toFixed(2) + 'B';
    if (v >= 1e6) return '$' + (v/1e6).toFixed(2) + 'M';
    return '$' + v.toLocaleString();
  },
  pct: v => v != null ? (v >= 0 ? '+' : '') + v.toFixed(2) + '%' : '—',
  ago: ts => {
    const diff = Math.floor((Date.now()/1000) - ts);
    if (diff < 60) return diff + 's ago';
    if (diff < 3600) return Math.floor(diff/60) + 'm ago';
    if (diff < 86400) return Math.floor(diff/3600) + 'h ago';
    return Math.floor(diff/86400) + 'd ago';
  }
};

function setText(id, val) { const el = document.getElementById(id); if (el) el.textContent = val; }

// Clock
function updateClock() { document.getElementById('clock').textContent = new Date().toUTCString().slice(17, 25) + ' UTC'; }
setInterval(updateClock, 1000); updateClock();

// ═══════════════════════════════════════
// STATE
// ═══════════════════════════════════════
let allNews = [];
let activeFilter = 'all';
let currentPage = 1;
const PER_PAGE = 12;

// ═══════════════════════════════════════
// FETCH PRICE DATA
// ═══════════════════════════════════════
async function fetchPrice() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=bitcoin&sparkline=false');
    const [btc] = await res.json();
    if (!btc) return;
    setText('ps-price', fmt.price(btc.current_price));
    setText('ps-high', fmt.price(btc.high_24h));
    setText('ps-low', fmt.price(btc.low_24h));
    setText('ps-mcap', fmt.compact(btc.market_cap));
    const chEl = document.getElementById('ps-change');
    if (chEl) {
      chEl.textContent = fmt.pct(btc.price_change_percentage_24h);
      chEl.style.color = btc.price_change_percentage_24h >= 0 ? 'var(--green)' : 'var(--red)';
    }
  } catch(e) {}
}

async function fetchGlobal() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/global');
    const { data } = await res.json();
    if (data) setText('ps-dom', data.market_cap_percentage.btc?.toFixed(1) + '%');
  } catch(e) {}
}

async function fetchFearGreed() {
  try {
    const res = await fetch('https://api.alternative.me/fng/?limit=7');
    const { data } = await res.json();
    if (!data) return;
    const current = data[0];
    const val = parseInt(current.value);
    const fgEl = document.getElementById('ps-fg');
    if (fgEl) {
      fgEl.textContent = val + ' — ' + current.value_classification;
      fgEl.style.color = val <= 30 ? 'var(--red)' : val >= 70 ? 'var(--green)' : 'var(--btc)';
    }

    // F&G History (7D)
    const fgHistory = document.getElementById('fg-history');
    if (fgHistory) {
      fgHistory.innerHTML = data.slice(0,7).reverse().map((d,i) => {
        const v = parseInt(d.value);
        const color = v <= 30 ? 'var(--red)' : v <= 45 ? 'rgb(255,120,0)' : v <= 55 ? 'var(--text)' : v <= 75 ? 'var(--btc)' : 'var(--green)';
        const date = i === 6 ? 'Today' : i === 5 ? 'Yesterday' : new Date(parseInt(d.timestamp)*1000).toLocaleDateString('en-US',{weekday:'short'});
        return `<div style="display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid rgba(247,147,26,0.06);">
          <span style="font-size:10px;color:var(--dim);">${date}</span>
          <div style="flex:1;height:4px;background:rgba(255,255,255,0.06);margin:0 10px;border-radius:2px;overflow:hidden;">
            <div style="height:100%;width:${v}%;background:${color};border-radius:2px;"></div>
          </div>
          <span style="font-family:'Orbitron';font-size:11px;color:${color};min-width:26px;text-align:right;">${v}</span>
        </div>`;
      }).join('');
    }
  } catch(e) {}
}

// ═══════════════════════════════════════
// FETCH NEWS — CryptoCompare
// ═══════════════════════════════════════
async function fetchNews() {
  try {
    const res = await fetch('https://min-api.cryptocompare.com/data/v2/news/?lang=EN&categories=BTC,Blockchain,Mining,Regulation,Technology&sortOrder=latest&extraParams=bitcoin_terminal');
    const json = await res.json();
    if (!json.Data) throw new Error('No data');

    allNews = json.Data.map(item => ({
      id: item.id,
      title: item.title,
      body: item.body,
      source: item.source_info?.name || item.source,
      url: item.url,
      ts: item.published_on,
      tags: item.tags ? item.tags.split('|').filter(Boolean).slice(0,4) : [],
      categories: item.categories ? item.categories.toLowerCase() : '',
      sentiment: classifySentiment(item.title + ' ' + (item.body||'').slice(0,200)),
    }));

    renderNews();
    buildBreakingTicker();
    buildTrendingTopics();
    buildSourcesList();
    buildSentiment();

    setText('article-count', allNews.length);
    document.getElementById('last-fetch').textContent = 'UPDATED ' + new Date().toLocaleTimeString();
  } catch(e) {
    console.error('News fetch error:', e);
    document.getElementById('news-feed').innerHTML = `<div style="text-align:center;padding:40px;color:var(--dim);font-size:12px;">
      Unable to load live news. <br><br>
      <a href="https://www.coindesk.com" target="_blank" style="color:var(--btc);">CoinDesk</a> &nbsp;|&nbsp;
      <a href="https://cointelegraph.com" target="_blank" style="color:var(--btc);">CoinTelegraph</a> &nbsp;|&nbsp;
      <a href="https://bitcoinmagazine.com" target="_blank" style="color:var(--btc);">Bitcoin Magazine</a>
    </div>`;
  }
}

// ═══════════════════════════════════════
// SENTIMENT CLASSIFIER
// ═══════════════════════════════════════
const BULLISH_WORDS = ['surge', 'rally', 'breakout', 'bullish', 'ath', 'record', 'adoption', 'approval', 'launch', 'partnership', 'growth', 'rise', 'gain', 'pump', 'upgrade', 'milestone', 'buy', 'bull'];
const BEARISH_WORDS = ['crash', 'drop', 'plunge', 'bearish', 'ban', 'hack', 'fraud', 'scam', 'fear', 'concern', 'fall', 'decline', 'sell', 'dump', 'bear', 'loss', 'risk', 'warning', 'down'];

function classifySentiment(text) {
  const t = text.toLowerCase();
  const bull = BULLISH_WORDS.filter(w => t.includes(w)).length;
  const bear = BEARISH_WORDS.filter(w => t.includes(w)).length;
  if (bull > bear + 1) return 'bullish';
  if (bear > bull + 1) return 'bearish';
  return 'neutral';
}

function sentimentBadge(s) {
  if (s === 'bullish') return '<span class="news-badge badge-bullish">BULLISH</span>';
  if (s === 'bearish') return '<span class="news-badge badge-bearish">BEARISH</span>';
  return '<span class="news-badge badge-neutral">NEUTRAL</span>';
}

// ═══════════════════════════════════════
// FILTER
// ═══════════════════════════════════════
const CATEGORY_MAP = {
  breaking: ['breaking','flash','just in','alert'],
  markets: ['market','price','trading','btc','exchange','spot','futures'],
  regulation: ['regulat','sec','law','legal','govern','policy','congress','bill'],
  technology: ['tech','protocol','layer','lightning','upgrade','code','develop'],
  mining: ['min','hash','energy','power','asic','difficulty'],
  etf: ['etf','fund','blackrock','fidelity','spot etf','approval'],
  macro: ['fed','inflation','economy','rate','dollar','macro','treasury'],
};

function matchesFilter(item, filter) {
  if (filter === 'all') return true;
  const keywords = CATEGORY_MAP[filter] || [];
  const text = (item.title + ' ' + item.categories).toLowerCase();
  return keywords.some(k => text.includes(k));
}

function filterNews(type, el) {
  activeFilter = type;
  currentPage = 1;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  if (el) el.classList.add('active');
  renderNews();
}

// Search
document.getElementById('search-input').addEventListener('input', function() {
  currentPage = 1;
  renderNews();
});

// ═══════════════════════════════════════
// RENDER NEWS
// ═══════════════════════════════════════
function renderNews() {
  const query = document.getElementById('search-input').value.toLowerCase();
  let filtered = allNews.filter(item => {
    const matchF = matchesFilter(item, activeFilter);
    const matchQ = !query || item.title.toLowerCase().includes(query) || item.source.toLowerCase().includes(query);
    return matchF && matchQ;
  });

  setText('article-count', filtered.length);

  const total = Math.ceil(filtered.length / PER_PAGE);
  const page = filtered.slice((currentPage-1)*PER_PAGE, currentPage*PER_PAGE);

  if (!page.length) {
    document.getElementById('news-feed').innerHTML = '<div style="text-align:center;padding:40px;color:var(--dim);font-size:12px;">NO ARTICLES FOUND</div>';
    document.getElementById('pagination').innerHTML = '';
    return;
  }

  const isBreakingFilter = activeFilter === 'breaking';

  document.getElementById('news-feed').innerHTML = page.map((item, i) => {
    const isBreaking = i === 0 && currentPage === 1 && isBreakingFilter;
    const tags = item.tags.map(t => `<span class="news-tag">${t}</span>`).join('');
    const snippet = item.body ? item.body.replace(/<[^>]+>/g,'').slice(0,200) + '...' : '';
    return `
    <a class="news-card${isBreaking ? ' breaking' : ''}" onclick="openModal(${allNews.indexOf(item)})" href="javascript:void(0)">
      <div class="news-meta">
        <span class="news-source${isBreaking ? ' breaking-src' : ''}">${item.source}</span>
        <span class="news-time">${fmt.ago(item.ts)}</span>
        ${isBreaking ? '<span class="news-badge badge-breaking">⚡ BREAKING</span>' : ''}
        ${sentimentBadge(item.sentiment)}
      </div>
      <div class="news-title">${item.title}</div>
      ${snippet ? `<div class="news-body">${snippet}</div>` : ''}
      ${tags ? `<div class="news-tags">${tags}</div>` : ''}
    </a>`;
  }).join('');

  // Pagination
  if (total > 1) {
    let pages = '';
    for (let p = 1; p <= Math.min(total, 8); p++) {
      pages += `<button class="page-btn${p === currentPage ? ' active' : ''}" onclick="goPage(${p})">${p}</button>`;
    }
    if (total > 8) pages += `<button class="page-btn" onclick="goPage(${total})">${total}</button>`;
    document.getElementById('pagination').innerHTML = pages;
  } else {
    document.getElementById('pagination').innerHTML = '';
  }
}

function goPage(p) { currentPage = p; renderNews(); window.scrollTo(0, 0); }

// ═══════════════════════════════════════
// BREAKING TICKER
// ═══════════════════════════════════════
function buildBreakingTicker() {
  const headlines = allNews.slice(0, 10).map(n => n.title);
  const items = [...headlines, ...headlines].map(h => `<span class="breaking-item"><span>▶</span>${h}</span>`).join('');
  document.getElementById('breaking-scroll').innerHTML = items;
}

// ═══════════════════════════════════════
// TRENDING TOPICS
// ═══════════════════════════════════════
function buildTrendingTopics() {
  // Count word frequency in titles
  const stopwords = new Set(['the','a','an','in','on','at','to','of','is','are','was','were','be','been','being','have','has','had','do','does','did','will','would','could','should','may','might','shall','can','bitcoin','btc','crypto','cryptocurrency','says','said','new','for','and','or','but','not','with','that','this','from','by','it','its','as','up','down']);
  const freq = {};
  allNews.slice(0,30).forEach(n => {
    n.title.toLowerCase().replace(/[^a-z\s]/g,'').split(/\s+/).forEach(w => {
      if (w.length > 3 && !stopwords.has(w)) freq[w] = (freq[w]||0) + 1;
    });
  });
  const sorted = Object.entries(freq).sort((a,b) => b[1]-a[1]).slice(0,7);
  const trendEl = document.getElementById('trending-topics');
  if (trendEl) {
    trendEl.innerHTML = sorted.map(([word, count], i) => `
      <div class="trend-item">
        <div class="trend-num">${String(i+1).padStart(2,'0')}</div>
        <div>
          <div class="trend-title">${word.toUpperCase()}</div>
          <div class="trend-meta">${count} mentions in recent news</div>
        </div>
      </div>`).join('');
  }
}

// ═══════════════════════════════════════
// SOURCES
// ═══════════════════════════════════════
function buildSourcesList() {
  const counts = {};
  allNews.forEach(n => { counts[n.source] = (counts[n.source]||0)+1; });
  const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,7);
  const el = document.getElementById('sources-list');
  if (el) el.innerHTML = sorted.map(([src, cnt]) => `
    <div class="source-item">
      <span style="font-size:11px;color:var(--text);">${src}</span>
      <span class="source-count">${cnt} articles</span>
    </div>`).join('');
}

// ═══════════════════════════════════════
// SENTIMENT
// ═══════════════════════════════════════
function buildSentiment() {
  const total = allNews.length;
  const bull = allNews.filter(n => n.sentiment === 'bullish').length;
  const bear = allNews.filter(n => n.sentiment === 'bearish').length;
  const bullPct = Math.round(bull/total*100);
  const bearPct = Math.round(bear/total*100);
  const sentLabel = document.getElementById('sent-label');
  const sentBar = document.getElementById('sent-bar');
  if (sentLabel) {
    if (bullPct > 55) { sentLabel.textContent = 'BULLISH'; sentLabel.style.color = 'var(--green)'; }
    else if (bearPct > 55) { sentLabel.textContent = 'BEARISH'; sentLabel.style.color = 'var(--red)'; }
    else { sentLabel.textContent = 'NEUTRAL'; sentLabel.style.color = 'var(--btc)'; }
  }
  if (sentBar) {
    sentBar.style.width = bullPct + '%';
    sentBar.style.background = bullPct > 55 ? 'var(--green)' : bearPct > 55 ? 'var(--red)' : 'var(--btc)';
  }
  setText('sent-bullish-pct', bullPct + '% BULLISH');
  setText('sent-bearish-pct', bearPct + '% BEARISH');
}

// ═══════════════════════════════════════
// UPCOMING EVENTS (static known events)
// ═══════════════════════════════════════
function buildUpcomingEvents() {
  const events = [
    { day: '~2028', mon: 'APR', title: 'Bitcoin Halving #5', desc: 'Block reward drops from 3.125 to 1.5625 BTC. Est. block #1,050,000.' },
    { day: '14', mon: 'MAR', title: 'FOMC Meeting', desc: 'Federal Reserve interest rate decision — key macro signal for risk assets.' },
    { day: '31', mon: 'MAR', title: 'Quarter End', desc: 'Q1 2026 close — institutional rebalancing may impact BTC flows.' },
    { day: '15', mon: 'APR', title: 'US Tax Deadline', desc: 'US tax filing deadline — historically associated with BTC sell pressure.' },
  ];
  const el = document.getElementById('upcoming-events');
  if (el) el.innerHTML = events.map(e => `
    <div class="event-item">
      <div class="event-date">
        <div class="e-day" style="font-size:${e.day.length > 3 ? '13px' : '20px'}">${e.day}</div>
        <div class="e-mon">${e.mon}</div>
      </div>
      <div class="event-info">
        <div class="e-title">${e.title}</div>
        <div class="e-desc">${e.desc}</div>
      </div>
    </div>`).join('');
}

// ═══════════════════════════════════════
// MODAL
// ═══════════════════════════════════════
function openModal(idx) {
  const item = allNews[idx];
  if (!item) return;
  document.getElementById('modal-title').textContent = item.title;
  document.getElementById('modal-meta').innerHTML = `
    <span style="color:var(--btc);">${item.source}</span>
    <span>${fmt.ago(item.ts)}</span>
    <span>${new Date(item.ts*1000).toLocaleString()}</span>
    ${sentimentBadge(item.sentiment)}
  `;
  document.getElementById('modal-body').innerHTML = item.body ? item.body.replace(/<[^>]+>/g,'') : 'No body text available. Click below to read the full article.';
  document.getElementById('modal-link').href = item.url;
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('modal-overlay') || e.type === 'click') {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// ═══════════════════════════════════════
// INIT
// ═══════════════════════════════════════
async function init() {
  buildUpcomingEvents();
  await Promise.allSettled([
    fetchPrice(),
    fetchGlobal(),
    fetchFearGreed(),
    fetchNews(),
  ]);
}

init();
setInterval(fetchNews, 120000);
setInterval(fetchPrice, 30000);
setInterval(fetchFearGreed, 300000);
</script>
</body>
</html>
